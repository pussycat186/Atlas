receivers:
  otlp:
    protocols: { grpc: {}, http: {} }
  prometheus:
    config:
      scrape_configs:
        - job_name: gateway
          metrics_path: /admin/metrics
          static_configs: [ { targets: ["gateway:3000"] } ]
  httpcheck/atlas:
    targets:
      - endpoint: http://gateway:3000/health
      - endpoint: http://web:3006/health
      - endpoint: http://admin:3007/health
      - endpoint: http://w1:3001/witness/health
      - endpoint: http://w2:3002/witness/health
      - endpoint: http://w3:3003/witness/health
      - endpoint: http://w4:3004/witness/health
      - endpoint: http://w5:3005/witness/health
    collection_interval: 30s

processors:
  batch: {}
  memory_limiter:
    check_interval: 1s
    limit_percentage: 80
    spike_limit_percentage: 25
  resourcedetection: { detectors: [env, system] }

exporters:
  prometheus: { endpoint: 0.0.0.0:8889 }
  otlp/tempo:
    endpoint: tempo:4317
    tls: { insecure: true }
  loki: { endpoint: http://loki:3100/loki/api/v1/push }

service:
  telemetry: { logs: { level: info } }
  pipelines:
    metrics: { receivers: [prometheus, httpcheck/atlas], processors: [memory_limiter, batch, resourcedetection], exporters: [prometheus] }
    traces:  { receivers: [otlp], processors: [memory_limiter, batch, resourcedetection], exporters: [otlp/tempo] }
