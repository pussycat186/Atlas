{
  "uid": "witness-latency",
  "title": "Witness p95/p99 Latency & Error",
  "tags": ["atlas", "witness"],
  "refresh": "10s",
  "time": { "from": "now-1h", "to": "now" },
  "templating": {
    "list": [
      {
        "name": "svc",
        "type": "textbox",
        "label": "Service regex",
        "query": "atlas-w[1-5]",
        "current": { "text": "atlas-w[1-5]", "value": "atlas-w[1-5]" }
      }
    ]
  },
  "panels": [
    {
      "type": "timeseries",
      "title": "p95 HTTP Latency (ms)",
      "targets": [
        {
          "expr": "histogram_quantile(0.95, sum by (le, service) (rate(traces_spanmetrics_duration_milliseconds_bucket{service=~\"$svc\"}[$__rate_interval])))",
          "legendFormat": "{{service}}"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "p99 HTTP Latency (ms)",
      "targets": [
        {
          "expr": "histogram_quantile(0.99, sum by (le, service) (rate(traces_spanmetrics_duration_milliseconds_bucket{service=~\"$svc\"}[$__rate_interval])))",
          "legendFormat": "{{service}}"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "HTTP Error Rate (%)",
      "targets": [
        {
          "expr": "100 * sum by (service) (rate(traces_spanmetrics_calls_total{service=~\"$svc\", status_code=~\"5..\"}[$__rate_interval])) / sum by (service) (rate(traces_spanmetrics_calls_total{service=~\"$svc\"}[$__rate_interval]))",
          "legendFormat": "{{service}}"
        }
      ]
    },
    {
      "type": "stat",
      "title": "Prometheus Target: otel-collector",
      "targets": [
        { "expr": "up{job=\"otel-collector\"}" }
      ]
    }
  ]
}
